<div class="container my-5">
  <!-- Page Title -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="fw-bold text-primary">Seller Dashboard</h1>
    <%= link_to "Edit Storefront", edit_seller_path(current_user.store_slug), class: "btn btn-outline-primary rounded-pill" %>
  </div>
  <hr>

  <!-- Storefront Description -->
  <div class="mb-5">
    <h4 class="fw-semibold">ğŸª Storefront Settings</h4>
    <p class="text-muted">Update your store name, logo, banner, and description.</p>
  </div>

  <!-- Summary Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card border-0 shadow-sm rounded-4 p-3 text-center bg-light">
        <h5 class="text-secondary mb-2">ğŸ›ï¸ Total Products</h5>
        <h3 class="fw-bold text-dark"><%= @products.count %></h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card border-0 shadow-sm rounded-4 p-3 text-center bg-light">
        <h5 class="text-secondary mb-2">ğŸ“¦ Total Orders</h5>
        <h3 class="fw-bold text-dark"><%= @orders.count %></h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card border-0 shadow-sm rounded-4 p-3 text-center bg-light">
        <h5 class="text-secondary mb-2">ğŸ’° Total Revenue</h5>
        <h3 class="fw-bold text-success">KES <%= number_to_currency(@orders.where(status: "paid").sum(:total), unit: "", precision: 2) %></h3>
      </div>
    </div>
  </div>

  <!-- Shipment Breakdown -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="card border-0 shadow-sm rounded-4 p-3 text-center bg-light">
        <h5 class="text-secondary mb-2">ğŸšš Pending Shipments</h5>
        <h3 class="fw-bold text-warning"><%= @orders.joins(:shipment).where(shipments: { status: "pending" }).count %></h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card border-0 shadow-sm rounded-4 p-3 text-center bg-light">
        <h5 class="text-secondary mb-2">ğŸš› In Transit</h5>
        <h3 class="fw-bold text-primary"><%= @orders.joins(:shipment).where(shipments: { status: "in_transit" }).count %></h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card border-0 shadow-sm rounded-4 p-3 text-center bg-light">
        <h5 class="text-secondary mb-2">ğŸ“¬ Delivered</h5>
        <h3 class="fw-bold text-success"><%= @orders.joins(:shipment).where(shipments: { status: "delivered" }).count %></h3>
      </div>
    </div>
  </div>

  <hr class="mb-5">

  <!-- Charts Section -->
  <div class="row g-5 mb-5">
    <div class="col-md-12">
      <h4 class="fw-semibold text-dark">ğŸ“ˆ Sales Over Time</h4>
      <div class="card border-0 shadow-sm rounded-4 p-3">
        <% if @sales_data.present? %>
          <%= line_chart @sales_data, height: "300px", colors: ["#007bff"] %>
        <% else %>
          <p class="text-muted text-center my-3">No sales data available yet.</p>
        <% end %>
      </div>
    </div>

    <div class="col-md-6">
      <h4 class="fw-semibold text-dark">ğŸ’¹ Revenue Trend</h4>
      <div class="card border-0 shadow-sm rounded-4 p-3">
        <% if @revenue_data.present? %>
          <%= area_chart @revenue_data, height: "300px", colors: ["#28a745"] %>
        <% else %>
          <p class="text-muted text-center my-3">No revenue data available yet.</p>
        <% end %>
      </div>
    </div>

    <div class="col-md-6">
      <h4 class="fw-semibold text-dark">ğŸ† Top Selling Products</h4>
      <div class="card border-0 shadow-sm rounded-4 p-3">
        <% if @top_products.present? %>
          <%= column_chart @top_products, height: "300px", colors: ["#ffc107"] %>
        <% else %>
          <p class="text-muted text-center my-3">No product sales yet.</p>
        <% end %>
      </div>
    </div>
  </div>

  <hr class="mb-5">

  <!-- Product List -->
  <div class="mb-5">
    <h3 class="fw-semibold mb-3">ğŸ§¾ My Products</h3>
    <% if @products.any? %>
      <div class="card border-0 shadow-sm rounded-4 p-3">
        <ul class="list-group list-group-flush">
          <% @products.each do |product| %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <%= link_to product.title, product_path(product), class: "text-decoration-none fw-semibold text-dark" %>
              <%= link_to "View", product_path(product), class: "btn btn-sm btn-outline-primary rounded-pill" %>
            </li>
          <% end %>
        </ul>
      </div>
    <% else %>
      <p class="text-muted">You havenâ€™t added any products yet.</p>
    <% end %>
  </div>

  <hr class="mb-5">

  <!-- Orders Table -->
  <div class="mb-5">
    <h3 class="fw-semibold mb-3">ğŸ“¦ Orders Received</h3>
    <% if @orders.any? %>
      <div class="table-responsive shadow-sm rounded-4">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-primary">
            <tr>
              <th>Buyer</th>
              <th>Products</th>
              <th>Status</th>
              <th>Payment</th>
              <th>Shipment</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody class="table-group-divider">
            <% @orders.each do |order| %>
              <% latest_payment = order.payments.last %>
              <tr>
                <td><%= order.buyer.email %></td>
                <td>
                  <% order.order_items.each do |item| %>
                    <%= link_to item.product.title, product_path(item.product), class: "text-decoration-none text-dark" %><br>
                  <% end %>
                </td>
                <td><span class="badge bg-secondary"><%= order.status.capitalize %></span></td>
                <td>
                  <span class="badge bg-info text-dark">
                    <%= latest_payment&.status&.capitalize || "Pending" %>
                  </span>
                </td>
                <td>
                  <span class="badge bg-warning text-dark">
                    <%= order.shipment&.status&.capitalize || "Not shipped" %>
                  </span>
                </td>
                <td>
                  <%= link_to "View", order_path(order), class: "btn btn-sm btn-outline-primary rounded-pill" %>
                  <% if latest_payment&.status == "paid" && order.shipment.nil? %>
                    <%= button_to "Create Shipment",
                          order_shipment_path(order),
                          method: :post,
                          class: "btn btn-sm btn-success rounded-pill mt-1",
                          data: { confirm: "Create shipment for this paid order?" } %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-muted">No orders received yet.</p>
    <% end %>
  </div>
</div>
