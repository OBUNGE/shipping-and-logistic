<div id="<%= dom_id(f.object) %>"
     class="border p-3 mb-2 bg-light rounded variant-block"
     data-saved-value="<%= f.object.value %>"
     data-key="<%= (f.object.id || Time.now.to_i) %>"
     data-category="<%= @product.category.name %>">

  <div class="row g-2">
    <!-- Variant Type -->
    <div class="col-md-4">
      <%= f.label :name, "Type", class: "form-label small" %>
      <%= f.select :name,
            ["Color","Size","Material","Finish","Packaging"],
            { selected: f.object.name },
            class: "form-select form-select-sm variant-type",
            required: true %>
    </div>

    <!-- Variant Value -->
    <div class="col-md-4">
      <%= f.label :value, "Option", class: "form-label small" %>
      <%= f.select :value,
            case f.object.name
            when "Color"     then ["Black","Brown","Tan","Cognac","Navy","White"]
            when "Size"
              if @product.category.name == "Menâ€™s Leather Shoes" || @product.category.name == "Womenâ€™s Leather Shoes"
                ["38","39","40","41","42","43","44"] # EU shoe sizes
              elsif @product.category.name == "Leather Bags"
                ["Small","Medium","Large"]
              elsif @product.category.name == "Leather Accessories"
                ["XS","S","M","L","XL"] # belts/straps
              else
                ["XS","S","M","L","XL"]
              end
            when "Material"  then ["Full-Grain Leather","Top-Grain Leather","Suede","Patent Leather"]
            when "Finish"    then ["Matte","Glossy","Textured"]
            when "Packaging" then ["Dust Bag","Gift Box","Eco Pouch"]
            else []
            end,
            { selected: f.object.value },
            class: "form-select form-select-sm variant-value",
            required: true,
            data: { current: f.object.value } %>
    </div>

    <!-- Price Modifier -->
    <div class="col-md-3">
      <%= f.label :price_modifier, "Price Modifier", class: "form-label small" %>
      <%= f.number_field :price_modifier,
            step: 0.01,
            placeholder: "e.g. 50.00",
            class: "form-control form-control-sm" %>
    </div>

    <!-- Delete Variant -->
    <div class="col-md-1 d-flex align-items-end">
      <%= f.hidden_field :_destroy, class: "destroy-flag" %>

      <% if f.object.persisted? %>
        <%= link_to "Delete",
              remove_variant_product_path(@product, id: f.object.id),
              data: { turbo_method: :delete, turbo_confirm: "Remove this variant?" },
              class: "btn btn-sm btn-outline-danger" %>
      <% else %>
        <button type="button" class="btn btn-sm btn-outline-danger delete-variant">Delete</button>
      <% end %>
    </div>
  </div>

  <!-- ðŸŽ¨ Variant Images (only for Color) -->
  <div class="mt-2 color-image-actions <%= 'd-none' unless f.object.name == 'Color' %>">
    <div id="variant_<%= f.object.id || f.object.object_id %>_images"
         class="variant-images-wrapper">
      <%= f.fields_for :variant_images do |image_fields| %>
        <%= render "variant_image_fields", f: image_fields %>
      <% end %>
    </div>

    <% if @product.persisted? && f.object.persisted? %>
      <%= link_to "âž• Add color image",
            add_variant_image_product_path(@product, id: f.object.id),
            data: { turbo_method: :post, turbo_stream: true },
            class: "btn btn-sm btn-outline-secondary" %>
    <% else %>
      <button type="button"
              class="btn btn-sm btn-outline-secondary add-variant-image-btn">
        âž• Add color image
      </button>
    <% end %>
  </div>
</div>