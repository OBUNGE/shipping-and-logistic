<div id="<%= dom_id(f.object) %>" class="border p-2 mb-2 bg-light rounded variant-image-block">
  <% if f.object.image_url.present? %>
    <%= image_tag f.object.image_url,
          class: "img-thumbnail mb-2 variant-image-preview" %>
  <% end %>

  <!-- File upload -->
  <%= f.file_field :image,
        class: "form-control form-control-sm",
        accept: "image/*",
        onchange: "previewVariantImage(event)" %>

  <!-- Hidden image_url field ensures persistence -->
  <%= f.hidden_field :image_url,
        value: f.object.image_url,
        class: "image-url-field" %>

  <!-- Destroy flag -->
  <%= f.hidden_field :_destroy, class: "destroy-flag" %>

  <% if f.object.persisted? %>
    <%= button_to "Delete",
          remove_variant_image_product_path(@product, id: f.object.id),
          method: :delete,
          form: { data: { turbo_confirm: "Remove this image?" } },
          class: "btn btn-sm btn-outline-danger" %>
  <% else %>
    <button type="button" class="btn btn-sm btn-outline-danger delete-variant-image">Delete</button>
  <% end %>
</div>

