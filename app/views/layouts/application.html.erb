<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-11C4F0DR0T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-11C4F0DR0T');
    </script>

    <%# --- 1. Dynamic Title --- %>
    <title><%= content_for?(:title) ? yield(:title) : "Tajaone | Affordable Leather Bags, Shoes & Goods in Kenya" %></title>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <%# --- 2. Dynamic Meta Description --- %>
    <meta name="description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : "Tajaone is Kenya’s trusted online store for high-quality, affordable leather products, including bags, shoes, and accessories. Secure M-PESA payments." %>">
    
    <meta name="keywords" content="Tajaone, Kenya leather products, affordable leather, leather goods, leather bags, leather shoes, genuine leather Nairobi, buy leather online, M-PESA payments">
    <meta name="author" content="Tajaone Team">
    <meta name="robots" content="index, follow">

    <%# --- 3. Canonical URL --- %>
    <link rel="canonical" href="<%= content_for?(:canonical) ? yield(:canonical) : (request.base_url + request.path) %>">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="facebook-domain-verification" content="2vfc3spsmp3a2jhmu6rmf5oepgoa1z" />
    <meta name="p:domain_verify" content="a1c82cd47386f67bc289e9e4ce21108e"/>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# --- 4. Performance --- %>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

    <%# --- 5. Favicons (Ensure icon.png exists in /public folder) --- %>
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# --- 6. Dynamic Open Graph (Social Media Sharing) --- %>
    <%# CRITICAL FIX: Ensure 'og_image' is an absolute URL. Use 'url_to_image(blob)' helper in views for ActiveStorage. %>
    <meta property="og:site_name" content="Tajaone">
    <meta property="og:title" content="<%= content_for?(:og_title) ? yield(:og_title) : (content_for?(:title) ? yield(:title) : "Tajaone | Kenya’s Leather Store") %>">
    <meta property="og:description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : "Shop high-quality, affordable leather products in Kenya with secure payments via M-PESA." %>">
    <meta property="og:image" content="<%= content_for?(:og_image) ? yield(:og_image) : image_url('icon.png') %>">
    <meta property="og:url" content="<%= request.original_url %>">
    <meta property="og:type" content="<%= content_for?(:og_type) ? yield(:og_type) : "website" %>">

    <%# --- 7. Dynamic Twitter Cards (X) --- %>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= content_for?(:title) ? yield(:title) : "Tajaone | Kenya’s Leather Store" %>">
    <meta name="twitter:description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : "Shop high-quality, affordable leather products in Kenya." %>">
    <meta name="twitter:image" content="<%= content_for?(:og_image) ? yield(:og_image) : image_url('icon.png') %>">
    <%# Twitter often caches images aggressively. Use a version string if updating the icon. %>

    <%= yield :head %>

    <%# --- 8. Organization Schema --- %>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "OnlineStore",
      "name": "Tajaone",
      "url": "<%= root_url %>",
      "logo": "<%= image_url('icon.png') %>",
      "description": "Kenya’s trusted online store for high-quality, affordable leather products.",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Nairobi",
        "addressCountry": "KE"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "<%= products_url %>?query={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <%# --- Bootstrap & Assets --- %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <%= javascript_importmap_tags %>

    <style>
      .navbar.sticky-top { z-index: 3000 !important; }
      .dropdown-menu { z-index: 3100 !important; }
      .navbar-collapse { text-align: left !important; }
    </style>
  </head>

  <body>
    <header>
      <%= render "layouts/navbar" %>
    </header>

    <%# --- Flash Messages --- %>
    <div id="flash-messages" class="container-fluid px-3 pt-2">
      <% flash.each do |key, value| %>
        <div class="alert alert-<%= key == "notice" ? "success" : "danger" %> alert-dismissible fade show shadow-sm" role="alert">
          <%= value %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>
    </div>

    <%# --- Main Content --- %>
    <main class="container-fluid px-0" role="main">
      <%= yield %>
    </main>

    <%# --- Footer --- %>
    <footer class="bg-light text-center py-4 mt-5 border-top">
      <div class="container">
        <p class="mb-1 small text-muted">
          &copy; <%= Time.current.year %> <strong>Tajaone</strong> — Kenya’s Source for Affordable Leather Products.<br>
          <span class="text-muted">Nairobi, Kenya</span>
        </p>
        <p class="mb-1">
          Email: <a href="mailto:sales@tajaone.app">sales@tajaone.app</a>
        </p>
        <nav class="footer-links">
          <%= link_to "Home", root_path %> |
          <%= link_to "About Us", about_path %> |
          <%= link_to "Contact", contact_path %> |
          <%= link_to "Return Policy", return_policy_path %>
        </nav>
      </div>
    </footer>
  </body>
</html>